name: V2Ray Auto-Updater

# Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ: Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù‡Ø± Û´ Ø³Ø§Ø¹Øª ÛŒÚ©â€ŒØ¨Ø§Ø± Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Ø¨ÛŒØ¯Ø§Ø± Ù…ÛŒØ´Ù‡
on:
  schedule:
    - cron: '0 */4 * * *'
  # Ø§ÛŒÙ† Ø®Ø· Ø¨Ø§Ø¹Ø« Ù…ÛŒØ´Ù‡ Ø¨ØªÙˆÙ†ÛŒ Ø¯Ø³ØªÛŒ Ù‡Ù… Ø±Ø¨Ø§Øª Ø±Ùˆ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒ
  workflow_dispatch:

jobs:
  run-python-script:
    runs-on: ubuntu-latest

    steps:
    - name: 1. Checkout Repository
      uses: actions/checkout@v4

    - name: 2. Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: 3. Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests rich

    - name: 4. Run Ultimate Scraper & Tester
      run: |
        # Ø³Ø±ÙˆØ± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ø®ÛŒÙ„ÛŒ Ù‚ÙˆÛŒÙ‡ØŒ Ù¾Ø³ ØªØ³Øª Ø±Ùˆ Ø¨Ø§ Û²Û°Û° ØªØ±Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ù„ Û²Û° Ù‡Ø²Ø§Ø± Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒØ¯ÛŒÙ…
        python ultimate_v2ray.py --all --threads 200

    - name: 5. Commit and Push Generated Sub Link
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        git add sub.txt
        git add good_configs.txt
        
        # Ø§Ú¯Ø± ÙØ§ÛŒÙ„ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ Ø°Ø®ÛŒØ±Ø´ Ú©Ù†
        git commit -m "ğŸš€ Auto-Update V2Ray Sub: $(date +'%Y-%m-%d %H:%M')" || echo "No changes to commit"
        git push
